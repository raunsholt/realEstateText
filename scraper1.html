<!DOCTYPE html>
<html>

<body>

  <h2>Boligtekster</h2>

  <form id="addressForm">
    <label for="street">Address:</label><br>
    <input type="text" id="address" name="address"><br>
    <input type="button" value="Submit" onclick="fetchBuildingData()">
    <p id="result"></p>
  </form>

  <script>
    function fetchBuildingData() {
      const address = encodeURIComponent(document.getElementById('address').value);
      const rawAddress = document.getElementById('address').value;

      fetch(`https://api.dataforsyningen.dk/adresser?q=${address}`)
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.json();
        })
        .then(data => {
          if (data.length > 0) {
            const adresseid = data[0].id;  // Get the id from the first returned address

            fetch(`https://api.dataforsyningen.dk/bbrlight/enheder?adresseid=${adresseid}`)
              .then(response => {
                if (!response.ok) {
                  throw new Error('Network response was not ok');
                }
                return response.json();
              })
              .then(buildingData => {
                if (buildingData.length > 0) {
                  document.getElementById('result').innerHTML = rawAddress + " er opført i " + buildingData[0].bygning.OPFOERELSE_AAR + ". Har " + buildingData[0].AntBadevaerelser + " badeværelse(r). Har " + buildingData[0].AntVandskylToilleter + " toilette(r). Har " + buildingData[0].VAERELSE_ANT + " værelse(r). Er på " + buildingData[0].ENH_ARL_SAML + " kvadratmeter." ;
                } else {
                  document.getElementById('result').innerHTML = 'No building information found for this address.';
                }
              })
              .catch(error => {
                console.error('There has been a problem with your fetch operation:', error);
              });

          } else {
            document.getElementById('result').innerHTML = 'No address found';
          }
        })
        .catch(error => {
          console.error('There has been a problem with your fetch operation:', error);
        });
    }
  </script>

</body>

</html>
